### 決定事項
- DoGフィルタによる改善を優先的に進める (自社・先方)
- テンプレートマッチングは現状のまま進める (自社・先方)
- "shape"画像を用いたテンプレートマッチングを継続する (自社・先方)

## ToDo
### 先方
- 高解像度のテスト画像を準備する（一眼レフカメラD5600使用）
- ビットマップ画像の設定変更を工事時に実施
- フォルダ構成案に基づいたデータ管理方法の提案

### 自社
- DoGフィルタによる改善を1-2週間で実施
- 照明条件に関する提案の社内検討
- 定量的な解像度評価方法の検討
- 誤認している欠陥候補の対策を整理して提案

## 議事内容
#### 会議の主題: CB02外観検査の改善方針に関する討議

1. 分析案件週次報告 (報告：自社)
   1.1. スケジュール確認
   1.2. 作業タスク確認
   1.3. 進捗報告
      1.3.1. CB02外観検査-欠陥候補検出の改善について
         - 欠陥候補検出における現状の課題
         - Cannyエッジ検出+テクスチャ検出(現状の手法)
         - Log(Laplacian of Gaussian)フィルタ+適応的閾値処理(提案)
         - Dog(Difference of Gaussian)フィルタ+動的閾値処理(提案)

2. 質疑応答
   - 現状のCannyで検出できない鋳巣は、欠陥検出では鋳巣は全て検出できたと思っているが、切り出し方が適切でないという意味合いか？ (先方A)
     → そうです。鋳巣の全体を切り出すことができておらず、一部分を切り出した画像をテンプレートと類似度を計算してしまっているため類似度が低くなってしまっている (自社A)
     (補足：正確な類似度計算のためには、鋳巣の全体形状を適切に切り出す必要がある)

   - 小さい鋳巣と大きい鋳巣が発生する可能性があるため、提案した手法で小さい鋳巣だけ見れればいいわけではない (先方A)
     → Cannyに関しては大きい鋳巣部分を正確に切り出せているため、今回提案した手法で小さい鋳巣部分を正確に切り出すことができるのであれば、大きい鋳巣はCanny、小さい鋳巣は今回提案した手法にするようにロジックを併用することも考えている (自社A)

3. CB02外観検査-今後の方針について
   3.1. 相談/検討内容
   <今後の検査装置改善の仕様決め>
   1) 鋳巣検出に必要な撮影画像の解像度の確認
      - 解像度を上げたテスト画像の作成(先方)→検出精度の確認(自社)
      - 解像度を上げたいが、どの程度を目安とすれば良いか現時点でわからない
      - まずは、テストとして数台マニュアル撮影した画像を準備し、どの程度の解像度で検出精度が確保できそうか確認したい

   <現状のモデル改善>
   追記) 解像度の低い鋳巣の検出をソフトで解決できるか検討(エッジ検出)
   2) 現状のモデルのテンプレートマッチングで使用している画像をNormal画像以外も実施
   3) 現状のモデルにテンプレート追加登録(他の面の鋳巣を活用)
   4) 今回作成したモデルでH面以外(4つの面)の鋳巣検査

   <その他>
   5) データの提出方法：何度か追加で提出しているが整理したいと個人的に感じる。どういった形で提出したら解析などがやりやすいか

4. 質疑応答
   1) 画像撮影について：
   - カメラは車内にあった一眼レフ(nikonのD5600の2400万画素)を使用予定。距離を変えることで解像度の違う画像を作成したい。照明は外側から照明を当てるアナログな状態を想定 (先方A)
     → 承知した (自社A)

   - 照明の当て方について何か指標はあるか？ (先方A)
     → 現状すぐに提案できないため、社内で確認/検討してお伝えする (自社A)

   - 現状の設備のキーエンスのカメラを差し替えることの対応可否は未確認 (先方A)
     → 可能であれば、同じ条件の方が望ましい (自社B)

   追記) エッジ検出方法について：
   - 小さい鋳巣の検出は、テンプレートマッチングせずにLoGとDoGで行うという考え方か？ (先方A)
     → Canny、Log、DoGは全て欠陥検出の部分の内容で、欠陥検出部分のロジックは欠陥候補の画像を切り出し、切り出した画像をテンプレート画像と比較して類似度を計算する (自社A)
     (補足：Canny、Log、DoGは、エッジ検出する際のフィルタの種類もしくは数が変わるという認識)

   - 小さい鋳巣はCannyで見ないため、Cannyは大きい鋳巣用に特化したようにパラメータを見直すことで、欠陥候補も減らすことができるという認識でよいか？ (先方A)
     → そのように改善できると思う (自社A)

   2) Normal画像について：
   - Normal画像は、加工面の部分を検出する際のみに使用し、テンプレートに使用する画像、欠陥候補を検出する画像はShape(キーエンス前処理後)の画像を使用している (自社A)

   3) 4) テンプレートの追加登録について：
   - 今後いろいろな形の鋳巣が出てきてテンプレートの追加が必要になった場合、結構手直しが必要になるか？ (先方A)
     → モデルの中身としては、切り出した画像をテンプレートと比較して類似度を計算しているだけなので、スクリプト(コード)自体を変更する必要はない。テンプレートの入っているディレクトリに都度追加するだけでよい (自社A)

   - 現場で使い始めた後にテンプレートを追加した場合も、そのテンプレートのフォルダに追加すれば、自動的にテンプレートマッチングを行うのか？ (先方A)
     → そうである (自社A)

   - 別の面の鋳巣が凹凸しているところにある場合の切り出しの懸念事項は問題ないか？ (自社B)
     → 現状の類似度の計算方法は、すべての欠陥候補に対して各テンプレートと類似度を計算している。1つの欠陥候補に対して、テンプレートの中で一番類似度が高い(最大値)ものが類似度95%以上の際、NG(鋳巣)と判断している。類似度が高くなるようなテンプレートを用意すれば可能 (自社A)
     (補足：凹凸があることによって、解像度やエッジ検出に影響が出る可能性はある)

   - Canny、Log、Dogどれを使った際も、欠陥候補の座標を特定し、テンプレートマッチングを行うという認識で良いか？ (先方A)
     → その認識で問題ない。欠陥候補の座標を特定し画像を切り出し、テンプレートマッチングを行う (自社A)

   - 現状の粗い画像に鋳巣を見ようとした時の品質の難しさは変わらないと思うが、LogやDogを使った際、どう変わってくるか？ (先方A)
     → 検証しないとわからないが、Cannyより解像度の低いものもエッジ検出ができる手法であったため提案した (自社A)

   - ツールマークのような細長い模様も鋳巣として誤認している件について、その除去は改善されるか？ (先方A)
     → 今回は欠陥候補検出に焦点を当てており、誤認している欠陥候補の対策は、まだしっかりと考えられていないので、一度整理してお伝えする (自社A)

   - テンプレートの追加登録について、鋳巣はどの面でも出やすい面があり、テンプレートは多い方が良いと考えている。鋳巣の画像を送付するので、テンプレートの追加を随時対応可能か？それとも精度に影響が出るため、現時点では触らない方が良いか？ (先方A)
     → 対応は可能である。ただし、精度評価の際の条件が異なるため、上司に報告する際に説明できるのであれば、追加しても良いと考える (自社A)
     → 条件が変わってしまうので、まずはこのままで。ただし、後でテンプレートファイルに追加できることは確認できた (先方A)
     → その認識で問題ない (自社A)

   5) データ提出方法について：
   - スズキ様の方で管理しやすい、使用データが理解できる構成にしていただきたい。フォルダ構成案を週次進捗報告資料に記載した (先方A)
     → これを参考にして、フォルダ構成を変える際は連絡する。この構成を踏まえてデータを入れるようにする (自社A)

   追加質問：
   - 今後の進め方について、LoG、DoGの評価を進める形で良いか？ (自社B)
     → Log、Dog両方ではなく、まずどちらかのみで、3~4週間の工数を1~2週間で終わるようなボリュームで行ってほしい (先方A)
     → どちらの方が改善の可能性が高いと思われるか？ (自社B)
     → DoGの方が高いと思う。まずは精度優先というところで、DoGから進めた方が良い (自社A)
     → 問題ない (先方A)

   - テンプレートが少ない懸念点として、テンプレートが多くなるほど、テンプレートに似たものを誤検知する確率が上がるため、テンプレートが3つの場合の現状の見逃し率が非常に低くなっていることを念頭に入れていただきたい (自社A)

   - 最終的にテンプレートマッチングを行う上で、解像度が粗いためハードを改善しようと考えている。同じ鋳巣のあるワークを解像度違いで何パターンか用意し、どの程度の解像度であれば安定して検出でき、誤検出を少なくできるかなど、定量的に判断したいが、具体的なアドバイスはあるか？ (先方A)
     → 定量的に示せる方法を検討する (自社A)

   - 現状のテンプレート(鋳巣)が3つあるが、そのワークは残っているか？小さくて検出できていないワークはあるか？ (自社B)
     → 小さい鋳巣のあるワークは残っていない (先方A)
     → その場合、解像度を上げた画像を作成しても、今のロジックで大きな鋳巣は検出できているため、解像度を上げても検出できるという結果がわかるだけで、根本的な課題を解決できたかの判断ができない (自社A)
     → 実施するかは社内で検討する (先方A)

   - ビットマップを用意できるか否かの確認状況について (自社B)
     → 今週工事を行う予定で、そこで設定を変える対応を行うため、来週にはお渡しできる予定 (先方A)
     → 形状画像まで変換は可能か？ (自社B)
     → お渡しは可能だが、それも今後小さな鋳巣がラインで出た際のものになってしまう (先方A)

   - 現状テンプレートに"shape"を使用しているが、"Normal"を使うことも可能である (自社A)
     → 鈴木さんが見る感触として、"shape"と"Normal"どちらが見やすいか？ (先方A)
     → 輝度変化や色があるため、"shape"の方が見やすい (自社A)
     (補足："Normal"を採用すると前処理が必要になる)
     → "shape"画像のまま進めてください (先方A)

#### 次回打ち合わせ：11/14(木) 11:00~12:00
