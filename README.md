<2つの課題> 
①小さい鋳巣に検査の条件を合わせると大きい鋳巣が正確に測れない。 
→0.4から0.7mmは測れるが、0.8から1.0mmを超えると正確に測れない 
②現状の画像処理では、隣接する鋳巣は2つとして判断するため人(1つとみなす)と判断が異なる 
→現在はクロージング処理で1つとみなしている。隣接する鋳巣は1つとして判断したい。

<PC処理方法>
1. 画像データの統合
   - レーザースキャンで得た高さデータを一つの大きな画像（H面形状）にまとめる
   - 結果：X, Y, Z座標を持つTIFFファイル
2. 検査領域の決定
   - 高さデータを使って2つの検査領域（領域1と領域2）を決める
   - 方法：高さ（色）の30000~40000の範囲を抽出
3. プロフィール設定
   - 検査対象外とする領域を設定（例：端から内側に少し入った部分）
   - 目的：不要な部分（膜バリなど）の誤検出を防ぐ
   - 設定：ボア回り0.02mm、その他0.03mm（変更可能）
4. 凹形状の検査
   - 151x151ピクセル（1.51mm x 1.51mm）の範囲で平均高さを計算
   - この平均と実際の高さを比較して凹んでいる部分を見つける
   - 凸の部分（プラスの値）は無視する
5. 鋳巣長さの測定とNG判定
   - 20μm以上凹んでいる部分を見つける
   - その中で50μm以上凹んでいる部分を鋳巣やキズと判断
   - 鋳巣の大きさを測り、規定値（0.5mm）以上ならNGと判定
   - ザク巣（小さな穴）が4個以上あるとNGと判定
6. 目視との差の調整
   - 機械での測定結果と人間の目視での結果に差がある
   - その差を補正する計算式を使って調整する
   - 計算式：Y = AX + B（Yが補正後の値、Xが元の測定値）

<課題解決を行う画像処理手法>
1. 動的閾値調整 (課題①②対応、手順5の改善)
   - -20μmと-50μmの閾値を動的に調整し、様々なサイズの鋳巣に対応
   - 実装: 局所的な表面特性に基づいて閾値を自動調整するアルゴリズムを開発
2. 形状ベースのクラスタリング (課題②対応、手順5の改善)
   - 隣接する鋳巣を1つとして判断するため、形状特徴量を利用したクラスタリングを実施
   - 実装: k-meansやDBSCANなどの簡単なクラスタリングアルゴリズムを適用
3. マルチスケール解析の導入 (課題①対応、手順4,5の改善)
   - 異なるスケールでの解析結果を統合し、小さい欠陥から大きい欠陥まで正確に検出・測定
   - 実装: ピラミッド型画像処理を用いて、異なる解像度レベルで画像を分析
4. エッジ保存平滑化フィルタの適用 (課題②対応、手順3,4の改善)
   - 隣接する鋳巣の境界を保持しつつノイズを除去
   - 実装: バイラテラルフィルタやガイデッドフィルタを使用
5. 適応型ウィンドウサイズの導入 (課題①対応、手順4の改善)
   - 151x151のウィンドウサイズを可変にし、小さい鋳巣には小さいウィンドウ、大きい鋳巣には大きいウィンドウを適用
   - 実装: 複数のウィンドウサイズ（例：101x101, 151x151, 201x201）で同時に解析し、最適な結果を選択
6. 濃淡画像との統合分析 (課題①②対応、手順5の改善)
   - 高さデータと濃淡画像を組み合わせて、より正確な欠陥検出を実現
   - 実装: 高さデータと濃淡画像の特徴を組み合わせた新しい判定基準を開発
7. 統計的外れ値検出の導入 (課題①対応、手順4,5の改善)
   - 局所的な異常を検出し、様々なサイズの鋳巣を正確に識別
   - 実装: Local Outlier Factor (LOF) などの簡単な異常検出アルゴリズムを適用
8. 形状特徴量の拡張 (課題②対応、手順5の改善)
   - 鋳巣の形状をより詳細に分析し、隣接する鋳巣の判別を改善
   - 実装: 楕円フィッティングや凸包アルゴリズムを用いて、より正確な欠陥形状を測定
