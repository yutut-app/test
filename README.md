# 6. DoGフィルタと動的閾値処理による欠陥検出のフロー

ステップ1: マルチスケールDoGフィルタによる基本的な特徴抽出
- 複数の異なる強さ(σ1=1.5, σ2=3.5など)のガウシアンフィルタをかけ、それぞれの差分を取る
- 強いガウシアンフィルタは大きな特徴を検出し、弱いガウシアンフィルタは細かい特徴を検出
- 複数のスケールの結果を統合することで、鋳巣の部分的な検出を防ぎ、全体形状を捉える
- 結果として、輝度の変化が大きい領域（エッジ）を検出

ステップ2: 輝度ベースの直接的な欠陥候補の検出
- 元画像から直接、明るい領域(閾値180以上)と暗い領域(閾値50以下)を抽出
- Sobelフィルタで輝度の変化量（勾配）を計算し、急激な輝度変化の領域を強調
- 局所的な平均値との差を計算し、周囲と異なる輝度を持つ領域を検出

ステップ3: コントラスト比による異常領域の絞り込み
- 局所領域内での標準偏差を計算し、これを基準としたコントラスト比を算出
- コントラスト比が一定以上(0.12以上)の領域のみを残し、ノイズを削減
- 輝度の絶対値ではなく相対的な変化を見ることで、画像全体の明るさの違いに対応

ステップ4: 検出結果の統合と精緻化
- DoGフィルタ、輝度ベース、コントラスト比の結果をAND演算で組み合わせ
- 近接した検出領域をマージ（統合）して一つの欠陥候補とする
- 二値化マスクを適用して検査対象領域外を除外
- 最終的に、黒い部分と白い部分の両方を含む鋳巣の全体形状を得る
