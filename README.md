### 1. Cannyエッジ検出 + テクスチャ検出（現状の手法）

**概要：**
画像中のエッジ（輝度が急激に変化する部分）とテクスチャ（表面の質感や模様）を検出し、鋳巣（0.5mm~2mmの穴状の欠陥）の位置を特定する手法です。鋳巣の周囲に現れるエッジと、欠陥部分特有のテクスチャの両方を利用して検出を行います。

**欠陥候補切り出しまでの処理手順：**
1. **入力画像の前処理**
   - カラー画像をグレースケールに変換
   - ノイズを軽減するためのガウシアンフィルタ処理

2. **Cannyエッジ検出**
   - 画像の輝度勾配（明るさの変化量）を計算
   - 非最大値の抑制（エッジの細線化）
   - 2つの閾値でエッジを検出（確実なエッジと不確実なエッジを区別）

3. **テクスチャ検出**
   - 局所的な領域の明るさの分布を解析
   - テクスチャの特徴量（コントラストや均一性など）を計算

4. **欠陥候補の切り出し**
   - エッジとテクスチャの検出結果を基に欠陥候補位置を特定
   - 特定された位置の周囲を矩形で切り出し

### 2. LoG（Laplacian of Gaussian）フィルタ + 適応的閾値処理

**概要：**
画像をぼかしてから2次微分を計算し、輝度の変化が急激な部分（鋳巣の縁など）を検出する手法です。異なる大きさ（0.5mm~2mm）の欠陥に対応するため、複数の強さでぼかし処理を行います。局所的な明るさに応じて閾値を調整することで、様々な条件下での検出を可能にします。

**欠陥候補切り出しまでの処理手順：**
1. **入力画像の前処理**
   - カラー画像をグレースケールに変換
   - 軽いノイズ除去処理

2. **LoGフィルタ処理**
   - 複数の強さ（σ値）でガウシアンぼかしを適用
   - 各ぼかし画像に対してラプラシアン（2次微分）を計算
   - 得られた結果を正規化（0-255の範囲に変換）

3. **適応的閾値処理**
   - 画像の各部分で局所的な閾値を計算
   - 閾値を基に欠陥候補領域を二値化（白黒画像に変換）

4. **欠陥候補の切り出し**
   - 異なるσ値での検出結果を組み合わせ
   - 検出された欠陥候補位置の周囲を矩形で切り出し

### 3. DoG（Difference of Gaussian）フィルタ + 動的閾値処理

**概要：**
異なる強さでぼかした2つの画像の差分を取ることで、特定のサイズ（0.5mm~2mm）の特徴を強調する手法です。画像全体の特性に基づいて閾値を自動的に調整し、欠陥を検出します。

**欠陥候補切り出しまでの処理手順：**
1. **入力画像の前処理**
   - カラー画像をグレースケールに変換
   - 軽いノイズ除去処理

2. **DoGフィルタ処理**
   - 2つの異なる強さでガウシアンぼかしを適用
   - 2つのぼかし画像の差分を計算
   - 複数の組み合わせ（σ値のペア）で処理を実行

3. **動的閾値処理**
   - 差分画像の平均値と標準偏差を計算
   - 統計値を基に適切な閾値を決定
   - 決定した閾値で欠陥候補領域を二値化

4. **欠陥候補の切り出し**
   - 異なるσ値の組み合わせでの検出結果を統合
   - 検出された欠陥候補位置の周囲を矩形で切り出し

### 各手法の主な特徴の比較：

**検出の特徴**
- Canny + テクスチャ：エッジとテクスチャの両方を使用するため、複数の特徴で欠陥を検出
- LoG：2次微分による急激な変化の検出で、小さな欠陥も検出可能
- DoG：異なるスケールでの差分により、様々な大きさの欠陥に対応

**小さな欠陥への対応**
- Canny + テクスチャ：小さな欠陥の検出が困難
- LoG：複数スケールの処理により小さな欠陥も検出可能
- DoG：スケールの組み合わせにより小さな欠陥にも対応

**ノイズの影響**
- Canny + テクスチャ：ノイズの影響を受けやすい
- LoG：ガウシアンフィルタによりノイズに強い
- DoG：2段階のぼかしによりノイズに最も強い
