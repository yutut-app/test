# 6. エッジ処理

## 目的
検出された欠陥候補のエッジを補完し、ワークの加工部のエッジ付近の誤検出を除去する。これにより、欠陥の形状をより正確に把握し、誤検出を低減する。

## 処理手順
1. ワーク加工部のエッジ検出と余裕幅付加
2. 欠陥候補エッジの細線化
3. エッジのノイズ除去と接続
4. 加工部エッジ近傍の欠陥候補除去

## 実装

### create_mask_edge_margin()
ワーク加工部のエッジを検出し、余裕幅を付加する関数：

1. エッジ検出
   - Cannyエッジ検出を使用
   - mask_edge_min_threshold、mask_edge_max_thresholdで感度調整

2. 余裕幅の付加
   - 指定されたマージン値で膨張処理
   - カーネルサイズ：(margin * 2 + 1)²
   - iterations=1で一定の拡張を保証

### complete_edges()
欠陥候補のエッジを処理する主要関数：

1. 前処理
   - 加工部エッジの検出と余裕幅付加
   - エッジの二値化（閾値0）

2. エッジ処理
   - スケルトン化による細線化
   - オープニングによるノイズ除去
   - クロージングによるエッジ接続

3. 結果の統合
   - エッジの補完（最大値による統合）
   - 加工部エッジ近傍の除去（マスク適用）

### process_images_for_edge_completion()
画像群に対してエッジ処理を実行する関数：

1. 処理対象
   - 大きな欠陥（Canny検出結果）
   - 小さな欠陥（DoG検出結果）

2. 処理フロー
   - エッジの補完処理
   - 加工部エッジの除去
   - 結果の整理と保存

## 可視化

### visualize_edge_processing()
処理結果を可視化する関数：

1. 表示内容
   - 処理前：元の検出結果
   - 処理後：エッジ処理後の結果

2. 表示方法
   - グレー：加工領域
   - 赤：Canny検出結果（大きな欠陥）
   - 青：DoG検出結果（小さな欠陥）

