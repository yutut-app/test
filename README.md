# 5. Canny+DoGによる欠陥候補検出 (Part 1)

## 目的
Shape画像から鋳巣（欠陥）を検出する。大きな欠陥はCannyエッジ検出で、小さな欠陥はDoG（Difference of Gaussian）フィルタで検出する。

## 処理手順
1. 明暗領域の検出
2. 勾配強度の計算
3. 大きな欠陥の検出（Canny）
4. 小さな欠陥の検出（DoG）
5. 検出結果の統合

##実装
## 基本機能関数

### detect_bright_dark_regions()
画像の明暗領域を検出する基本関数：

1. 処理内容
   - bright_threshold以上の領域を明部として検出
   - dark_threshold以下の領域を暗部として検出
   - 二値化による明確な領域分割

2. 用途
   - 鋳巣の特徴的な明暗パターンの検出
   - 後続の処理での領域制限

### compute_gradient_magnitude()
画像の勾配強度を計算する関数：

1. 処理内容
   - Sobelフィルタによる勾配計算（x方向、y方向）
   - 勾配の大きさを計算
   - 0-255の範囲に正規化

2. 用途
   - エッジ強度の評価
   - コントラスト変化の検出

### detect_edges_and_texture()
Cannyエッジ検出による大きな鋳巣の検出：

1. 処理ステップ
   - マスク領域の抽出
   - 明暗領域の検出
   - Cannyエッジ検出
   - テクスチャ検出（Laplacian）
   - 勾配強度の計算
   - 検出結果の統合

2. 特徴
   - 複数の検出手法の組み合わせ
   - モルフォロジー処理による結果の洗練
   - マスクによる検査領域の制限

### difference_of_gaussian()
DoGフィルタを適用する関数：

1. 処理内容
   - 2つの異なるσ値でガウシアンブラー適用
   - ブラー結果の差分を計算

2. 用途
   - 特定のスケールの特徴抽出
   - 小さな欠陥の強調

# 5. Canny+DoGによる欠陥候補検出 (Part 2)

## 補助機能関数

### dynamic_threshold()
適応的閾値処理を行う関数：

1. 処理内容
   - 局所領域ごとに最適な閾値を計算
   - ガウシアン重み付けによる閾値決定
   - 反転二値化処理の適用

2. パラメータ調整
   - ksize：局所領域のサイズ
   - method：閾値計算方法
   - c：閾値調整定数

### detect_defects_dog_dynamic()
DoGフィルタによる小さな鋳巣の検出：

1. 処理ステップ
   - 明暗領域の検出
   - マルチスケールDoGの適用
     - 異なるσ値の組み合わせ
     - [(1.5, 3.5), (2.0, 4.0), (1.0, 2.5)]
   - 動的閾値処理
   - 輝度変化の計算
   - コントラスト比の評価

2. 統合処理
   - 各検出結果の論理演算による統合
   - モルフォロジー処理による結果の洗練
   - マスクによる領域制限

## メイン処理関数

### combine_defect_detection()
Cannyエッジ検出とDoG検出を統合する関数：

1. 処理内容
   - 大きな欠陥の検出（Canny）
   - 小さな欠陥の検出（DoG）
   - 両結果の論理和による統合

2. 出力
   - combined_result：統合結果
   - large_defects：大きな欠陥の検出結果
   - small_defects：小さな欠陥の検出結果

### process_images_for_defect_detection()
画像群に対して一括処理を行う関数：

1. 入力データ
   - マスク画像
   - Shape画像
   - ファイル名
   - テンプレート情報

2. 処理フロー
   - 各画像ペアに対する欠陥検出
   - 結果の保存と整理

##可視化
### visualize_defect_detection()
検出結果を可視化する関数：

1. 表示内容
   - 統合検出結果（グレースケール）
   - 色分け表示
     - 赤：Canny検出結果
     - 青：DoG検出結果

2. レイアウト
   - 2段表示
   - 適切なタイトルと説明
   - 結果の視覚的区別

これらの処理により、サイズの異なる欠陥を効果的に検出し、その結果を視覚的に確認することが可能となる。パラメータの調整により、検出感度と精度のバランスを制御できる。
