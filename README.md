# 時系列データの前処理と可視化の準備

このセクションでは、鋳造プロセスの時系列データを分析するための準備を行います。具体的には、データの整理、分析対象となる条件の特定、そして結果の可視化のための設定を行います。

## なぜこの作業が重要か？

1. **データの整理**: 
   日付と時間を適切な形式に変換することで、時系列での分析が可能になります。これにより、時間帯や曜日ごとの傾向を把握できます。

2. **分析対象の特定**: 
   鋳造条件の列を特定することで、品質に影響を与える可能性のある要因を絞り込むことができます。

3. **可視化の準備**: 
   結果を保存するフォルダを作成し、グラフの色を設定することで、分かりやすく一貫性のある可視化が可能になります。

## コードの説明

```python
import pandas as pd
import os
from datetime import datetime

# データの読み込みと前処理
df = pd.read_csv('casting_data.csv')
df['日時'] = pd.to_datetime(df['日時'])
df['日付'] = df['日時'].dt.date

# 鋳造条件の列名を取得（整数型と小数点型の列）
casting_condition_columns = df.select_dtypes(include=['int64', 'float64']).columns.tolist()
casting_condition_columns = [col for col in casting_condition_columns if col != '目的変数']

# 出力ディレクトリの作成
output_dir = r'..\data\output\eda\NG数の時系列の偏り\日ごとの偏り'
os.makedirs(output_dir, exist_ok=True)

# 品番ごとの固定色を定義
color_map = {
    2: 'red',
    4: 'blue',
    5: 'green',
    6: 'purple'
}
```

このコードは以下のことを行っています：

1. データを読み込み、'日時'列をdatetime型に変換し、新たに'日付'列を作成しています。これにより、日付ごとの分析が容易になります。

2. 数値型（整数と小数点）の列を鋳造条件として特定しています。ただし、'目的変数'（おそらく製品の良否を示す変数）は除外しています。

3. 分析結果を保存するためのフォルダを作成しています。

4. 各品番に固有の色を割り当てています。これにより、グラフ上で品番ごとの傾向を一目で識別できるようになります。

このような準備を行うことで、以降の分析作業がスムーズに進行し、結果の解釈も容易になります。例えば、時間帯や曜日ごとの不良品率の変化、特定の鋳造条件と品質の関係などを視覚的に把握しやすくなります。

次のステップでは、これらの設定を利用して実際のデータ分析と可視化を行います。時系列でのNG率の変化や、特定の条件下での品質の傾向などを探ることができるでしょう。
