各手法について、欠陥候補の検出と切り出しまでの工程を説明します。対象は0.5mm~2mmの鋳巣（穴状の欠陥）です。

### 1. Cannyエッジ検出 + テクスチャ検出

**概要：**
エッジの強さと方向を検出するCannyエッジ検出と、表面の模様や凹凸の変化を検出するテクスチャ検出を組み合わせて、鋳巣の位置を特定する手法です。エッジとテクスチャの両方の特徴を使うことで、穴状の欠陥を検出します。

**処理手順：**
1. **前処理**
   - ノイズを除去するためにガウシアンフィルタを適用
   - カラー画像をグレースケールに変換して輝度情報を抽出
   - 画像の明るさやコントラストを適切に調整

2. **エッジ検出処理**
   - Cannyエッジ検出で輝度の急激な変化部分を検出
   - 2つの閾値を使用して強いエッジと弱いエッジを検出
   - エッジの方向も考慮して欠陥の輪郭を特定

3. **テクスチャ検出処理**
   - 局所的な領域の輝度パターンを解析
   - 正常な表面とは異なるテクスチャパターンを検出
   - 表面の凹凸や模様の変化を数値化

4. **欠陥候補領域の切り出し**
   - エッジとテクスチャの検出結果を重ね合わせ
   - 検出された特徴が強い領域を欠陥候補として特定
   - 欠陥候補を含む矩形領域を切り出し

### 2. LoG（Laplacian of Gaussian）フィルタ + 適応的閾値処理

**概要：**
画像をぼかしてから2次微分を計算するLoGフィルタを使用し、輝度の変化が急激な部分を検出する手法です。局所的な明るさに応じて閾値を調整する適応的閾値処理と組み合わせることで、様々な大きさの鋳巣を検出します。

**処理手順：**
1. **前処理**
   - カラー画像をグレースケールに変換して輝度情報を抽出
   - 初期ノイズを軽減するための軽いぼかし処理
   - 画像のコントラストを強調して欠陥を見やすく

2. **LoGフィルタ処理**
   - 複数の強さ（σ値）でガウシアンぼかしを適用
   - 各ぼかし画像に対してラプラシアン演算で2次微分を計算
   - 異なるスケールでの検出結果を保持

3. **閾値処理**
   - 局所領域ごとに最適な閾値を計算
   - 周辺領域の明るさに応じて閾値を自動調整
   - 各スケールで二値化処理を実行

4. **欠陥候補領域の切り出し**
   - 異なるスケールでの検出結果を統合
   - 検出された特徴の強い部分を欠陥候補として特定
   - 欠陥候補を含む矩形領域を切り出し

### 3. DoG（Difference of Gaussian）フィルタ + 動的閾値処理

**概要：**
異なる強さでぼかした2つの画像の差分を取るDoGフィルタを使用し、特定のサイズの特徴を強調する手法です。画像全体の統計的特徴に基づいて閾値を決定する動的閾値処理と組み合わせることで、鋳巣を検出します。

**処理手順：**
1. **前処理**
   - カラー画像をグレースケールに変換して輝度情報を抽出
   - 初期ノイズを軽減するための軽いぼかし処理
   - 画像のコントラストを強調して欠陥を見やすく

2. **DoGフィルタ処理**
   - 異なる強さ（σ値）の組で複数のガウシアンぼかしを適用
   - 各σ値の組み合わせで差分画像を計算
   - 異なるスケールでの検出結果を保持

3. **閾値処理**
   - 画像全体の平均と標準偏差を計算
   - 統計値に基づいて適切な閾値を決定
   - 各スケールで二値化処理を実行

4. **欠陥候補領域の切り出し**
   - 異なるスケールでの検出結果を統合
   - 検出された特徴の強い部分を欠陥候補として特定
   - 欠陥候補を含む矩形領域を切り出し

これらの手法は、それぞれ異なるアプローチで0.5mm~2mmの鋳巣を検出しようとします。特に小さな欠陥の検出には、LoGやDoGの多重スケール処理が効果的である可能性が高いです。
