# 6. DoGフィルタと動的閾値処理による欠陥検出
本セクションでは、鋳巣（キズや欠陥）を検出するために、DoG（Difference of Gaussian）フィルタと動的閾値処理を組み合わせた手法を実装します。この組み合わせにより、様々なサイズの鋳巣を検出し、画像の明るさの変化にも対応できます。

目的：
- 小さな鋳巣（5px×5px）から大きな鋳巣まで検出する
- グラデーション状の変化にも対応する
- 鋳巣の全体形状を把握する
- ノイズの影響を最小限に抑える

説明：
1. `difference_of_gaussian`:
- 2つの異なるぼかし度合い（σ値）でガウシアンフィルタを適用し、その差分を計算
- これにより、エッジや特徴的な部分を強調することができる
- 異なるサイズの特徴を検出できる

2. `dynamic_threshold`:
- 画像の各部分の明るさに応じて自動的に閾値を調整する
- 局所的な領域ごとに適切な閾値を設定することで、画像全体の明るさの変化に対応
- グラデーション状の変化でも安定した検出が可能

3. `detect_defects_dog_dynamic`:
- DoGフィルタと動的閾値処理を組み合わせて欠陥を検出
- マルチスケールDoGで異なるサイズの特徴を検出
- 輝度差とコントラスト比に基づくフィルタリングで誤検出を低減
- 近接した領域を統合して鋳巣の全体を一つの欠陥として検出

4. `process_images_for_defect_detection`:
- 画像群に対して欠陥検出処理を適用
- 処理結果を保持して次の工程に渡す

この手法により、従来の手法では検出が困難だった小さな鋳巣や、グラデーション状の変化を持つ欠陥も検出することが可能になります。
