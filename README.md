### 各手法の説明（欠陥候補切り出しまで）

## 1. Cannyエッジ検出 + テクスチャ検出

**概要：**
Cannyエッジ検出は画像内の輝度が急激に変化する部分（エッジ）を検出し、テクスチャ検出は表面の凹凸や模様の変化を検出します。鋳巣（小さな穴、0.5mm~2mm）は周囲との輝度差やテクスチャの違いとして現れるため、これらの手法を組み合わせて検出します。

**処理手順：**

1. **グレースケール変換**
   - **目的**: カラー情報を輝度情報のみに単純化
   - **処理**: RGB画像を輝度値のみの画像に変換

2. **ノイズ除去（ガウシアンフィルタ）**
   - **目的**: 細かいノイズを除去し、誤検出を防ぐ
   - **処理**: 画像全体をわずかにぼかす

3. **エッジ検出（Canny）**
   - **目的**: 鋳巣の縁（輪郭）を検出
   - **処理**:
     - 輝度の勾配（変化量）を計算
     - 大小2つの閾値で重要なエッジを抽出

4. **テクスチャ検出**
   - **目的**: 表面の微細な変化を検出
   - **処理**: 局所的な領域の輝度パターンを解析

5. **欠陥位置の検出と切り出し**
   - エッジとテクスチャの検出結果から欠陥候補位置を特定
   - 特定された位置を中心に一定サイズの領域を切り出し

## 2. LoG（Laplacian of Gaussian）フィルタ + 適応的閾値処理

**概要：**
LoGフィルタは、画像をぼかしてから2次微分を計算することで、輝度の変化が急激な部分を検出します。鋳巣のような穴状の欠陥は、周囲との輝度差が大きいため、このフィルタで効果的に検出できます。さらに、適応的閾値処理により、画像の局所的な明るさの違いに対応します。

**処理手順：**

1. **グレースケール変換**
   - **目的**: カラー情報を輝度情報のみに単純化
   - **処理**: RGB画像を輝度値のみの画像に変換

2. **複数スケールでのLoGフィルタ処理**
   - **目的**: 異なるサイズ（0.5mm~2mm）の鋳巣を検出
   - **処理**:
     - 複数の強さ（σ値）でガウシアンぼかしを適用
     - 各ぼかし画像に対して2次微分（Laplacian）を計算
     - サイズの異なる鋳巣に対応するため、複数のσ値で処理

3. **適応的閾値処理**
   - **目的**: 画像の局所的な明るさの違いに対応
   - **処理**:
     - 小さな領域ごとに最適な閾値を計算
     - 局所的な輝度変化に基づいて欠陥候補を抽出

4. **欠陥位置の検出と切り出し**
   - 複数スケールの結果を統合して欠陥候補位置を特定
   - 特定された位置を中心に一定サイズの領域を切り出し

## 3. DoG（Difference of Gaussian）フィルタ + 動的閾値処理

**概要：**
DoGフィルタは、異なる強さでぼかした2つの画像の差分を取ることで、特定のサイズの特徴を強調します。鋳巣のような局所的な特徴は、適切なぼかしの差分で効果的に検出できます。動的閾値処理により、画像全体の特性に応じて検出を行います。

**処理手順：**

1. **グレースケール変換**
   - **目的**: カラー情報を輝度情報のみに単純化
   - **処理**: RGB画像を輝度値のみの画像に変換

2. **複数スケールでのDoGフィルタ処理**
   - **目的**: 異なるサイズ（0.5mm~2mm）の鋳巣を検出
   - **処理**:
     - 2つの異なる強さ（σ値）でガウシアンぼかしを適用
     - ぼかした画像同士の差分を計算
     - 複数のσ値の組み合わせで処理を実行

3. **動的閾値処理**
   - **目的**: 画像全体の特性に応じた閾値設定
   - **処理**:
     - 画像全体の統計量（平均、標準偏差）を計算
     - 統計量に基づいて適切な閾値を決定
     - 閾値に基づいて欠陥候補を抽出

4. **欠陥位置の検出と切り出し**
   - 複数スケールの結果を統合して欠陥候補位置を特定
   - 特定された位置を中心に一定サイズの領域を切り出し

各手法とも、検出された欠陥候補領域は、後続のテンプレートマッチングによる判定に使用されます。
