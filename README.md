手法概要：
メディアンフィルタは、画像のノイズ除去に使用される手法です。各ピクセルの値を、その周辺のピクセル値の中央値（メディアン）で置き換えます。これは、突然の輝度変化（ノイズ）を抑えつつ、エッジ（境界）を保持するのに効果的です。

どういった問題の際に使用する手法か：
画像にソルト＆ペッパーノイズ（白と黒の点状のノイズ）がある場合や、細かい凹凸を平滑化したい場合に使用します。

現状の手順のどこの部分なのか：
手順4の全ピクセルに対する151x151の高さ平均処理の部分に適用します。

2つの課題のうちどちらに対するアプローチなのか：
主に課題①（大きい鋳巣の測定精度向上）に対するアプローチです。

実装手順：
1. 画像処理ライブラリ（例：OpenCV）をインストールします。
2. グレースケールのTIFFファイルを読み込みます。
3. メディアンフィルタのウィンドウサイズを設定します（例：151x151）。
4. 画像の各ピクセルに対して以下の処理を行います：
   a. ピクセルを中心とする151x151の領域内の全ピクセル値を取得します。
   b. 取得したピクセル値を昇順に並べ替えます。
   c. 並べ替えたリストの中央の値（メディアン）を選びます。
   d. 元のピクセル値をこのメディアン値で置き換えます。
5. フィルタリングされた画像を用いて、以降の処理（鋳巣深さの計算など）を続けます。

どういう原理でこの手順で課題を解決できるのか：
メディアンフィルタは、周囲のピクセル値の中央値を選ぶことで、極端な値（ノイズ）の影響を受けにくいという特性があります。これにより、以下のような効果が期待できます：
1. ノイズ除去：小さな凹凸や突出した値を持つノイズを効果的に除去できます。これにより、誤って小さな凹凸を鋳巣と判定してしまう可能性を減らせます。
2. エッジ保持：平均化フィルタと違い、エッジ（鋳巣の境界）をぼかさずに保持する傾向があります。これにより、大きい鋳巣（0.8mm以上）の形状をより正確に捉えることができる可能性があります。
3. 異常値への耐性：極端に深い or 浅い値（異常値）があっても、それらの影響を受けにくいです。これにより、鋳巣の形状をより安定して検出できる可能性があります。
4. 深さ情報の保持：グレースケールで表現された深さ情報を、極端な値を除去しつつ保持できます。これにより、鋳巣の深さを正確に測定できる可能性が高まります。

メリット：
1. ノイズに強く、小さな凹凸による誤検出を減らせる可能性があります。
2. エッジ（鋳巣の境界）をよく保持するため、大きい鋳巣の形状をより正確に捉えられる可能性があります。
3. 異常値の影響を受けにくいため、安定した測定結果が得られる可能性があります。
4. 平均化フィルタよりもエッジをシャープに保つため、0.8mm以上の大きい鋳巣の測定精度が向上する可能性があります。

デメリット：
1. 計算量が平均化フィルタより多くなるため、処理時間が増加する可能性があります。
2. 非常に小さい鋳巣（ウィンドウサイズより小さい）が平滑化されて検出できなくなる可能性があります。
3. 鋳巣の細かい内部構造が失われる可能性があります。
4. 大きなウィンドウサイズ（151x151）を使用すると、計算時間が大幅に増加する可能性があります。
5. 鋳巣の形状によっては、エッジがステップ状になる可能性があります。
6. パラメータ（ウィンドウサイズ）の最適値を見つけるのに時間がかかる可能性があります。

