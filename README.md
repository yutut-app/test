# 6. 欠陥ごとのモデル評価

本セクションでは、欠陥（鋳巣）単位での分類性能を評価する。各欠陥に対する検出精度を詳細に分析し、モデルの性能を定量的に評価する。

## 評価指標の解釈

1. 鋳巣検出率
   - 実際の鋳巣をどれだけ検出できたか
   - 高いほど見逃しが少ない

2. 鋳巣誤検出率
   - 非鋳巣をどれだけ誤って鋳巣と判定したか
   - 低いほど過剰検出が少ない

3. 正解率
   - 全判定のうち、正しい判定の割合
   - 総合的な性能指標

これらの評価により、欠陥検出システムの性能を定量的に把握し、必要に応じたパラメータの調整や改善点の特定が可能となる。

## 実装の詳細

### calculate_defect_metrics()
欠陥レベルでの各種性能指標を計算する関数：

1. 混同行列の計算
   - True Positive (TP)：正しく検出された鋳巣
   - False Positive (FP)：誤って検出された鋳巣
   - False Negative (FN)：見逃された鋳巣
   - True Negative (TN)：正しく非鋳巣と判定

2. 評価指標の算出
   - 鋳巣検出率 = TP / (TP + FN) × 100
   - 鋳巣誤検出率 = FP / (TN + FP) × 100
   - 正解率 = (TP + TN) / 総数 × 100

3. エラー処理
   - 分母が0となる場合の処理
   - 例外発生時のエラーハンドリング

### print_defect_metrics()
評価結果を可読性の高い形式で表示する関数：

1. 基本指標の表示
   ```
   === 欠陥レベルでの評価結果 ===
   鋳巣検出率: XX.XX% (検出数/総数)
   鋳巣誤検出率: XX.XX% (誤検出数/非欠陥総数)
   正解率: XX.XX% (正解数/総数)
   ```

2. 混同行列の表示
   ```
   === 混同行列 ===
   True Positive (TP): XX
   False Positive (FP): XX
   False Negative (FN): XX
   True Negative (TN): XX
   ```

### evaluate_defect_level_performance()
欠陥レベルでの性能評価を実行する関数：

1. 処理フロー
   - 評価指標の計算
   - 結果の表示
   - 指標のデータ保持

2. エラー処理
   - 計算失敗時の処理
   - 異常値のハンドリング

